---
// src/pages/horarios/[id].astro
import Layout from '../../layouts/Layout.astro';
import PurchaseFlow from '../../components/PurchaseFlow.jsx';
import PurchaseBreadcrumbReact from '../../components/PurchaseBreadcrumbReact.jsx';
const supabase = Astro.locals.supabase;
const { id } = Astro.params;

const { data: pelicula } = await supabase
  .from('peliculas')
  .select('id, titulo, imagen_url')
  .eq('id', id)
  .single();

if (!pelicula) return Astro.redirect("/404");
---

<Layout title={`Horarios para ${pelicula.titulo}`}>
  <main class="min-h-screen pt-28" style="background: linear-gradient(135deg, #f8f5f0 0%, #f2ede6 100%);">
    <div class="container mx-auto px-4 sm:px-8 py-8">
      
      {/* Sidebar con la información de la película */}
      <div class="flex flex-col lg:flex-row gap-8">
        <aside class="w-full lg:w-80 flex-shrink-0">
          <div class="bg-white rounded-2xl shadow-lg overflow-hidden sticky top-24">
            <img src={pelicula.imagen_url} alt={`Póster de ${pelicula.titulo}`} class="w-full h-auto object-cover" />
            <div class="p-6">
              <h1 class="text-2xl font-bold text-gray-800">{pelicula.titulo}</h1>
            </div>
          </div>
        </aside>

        {/* Contenido principal con la ruta y el selector */}
        <div class="flex-1">
          <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
            <div class="mb-8">
              <PurchaseBreadcrumbReact currentStep="horarios" />
            </div>
            <PurchaseFlow client:load peliculaId={pelicula.id} />
          </div>
        </div>
      </div>

    </div>
  </main>
</Layout>