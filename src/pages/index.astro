---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import FilterSidebar from '../components/FilterSidebar.jsx';
import { supabase } from '../lib/supabaseClient.js';
// Obtiene todas las películas
const { data: peliculas, error: peliculasError } = await supabase
  .from('peliculas')
  .select('*');
// Obtiene todas las ciudades
const { data: ciudades, error: ciudadesError } = await supabase
  .from('ciudades')
  .select('*');
// Obtiene todos los cines
const { data: cines, error: cinesError } = await supabase
  .from('cines')
  .select('*');
if (peliculasError || ciudadesError || cinesError) {
  console.error("Error al obtener datos:", peliculasError || ciudadesError || cinesError);
}
const movies = peliculas || [];
const cities = ciudades || [];
const cinemas = cines || [];
---

<Layout title="Cartelera - UVK Cines">
  <main class="min-h-screen p-8 mt-24" style="background: linear-gradient(180deg, #f8f5f0 0%, #f2ede6 50%, #ede7dc 100%); color: #2c2c2c;">
    <div style="background-color: transparent;" class="border-b pb-8 mb-8" style="border-color: #e5ddd0;">
      <div class="container mx-auto px-8">
        <div class="flex items-center py-8">
          <h1 class="text-5xl font-bold mr-12" style="color: #e50914; text-shadow: 2px 2px 4px rgba(229, 9, 20, 0.1);">Películas</h1>
          <nav class="flex space-x-12">
            <a href="#" class="text-xl font-bold border-b-3 pb-3 transition-all duration-300" style="color: #e50914; border-color: #e50914; text-shadow: 1px 1px 2px rgba(229, 9, 20, 0.1);">En cartelera</a>
            <a href="#" class="text-xl font-semibold pb-3 transition-all duration-300" style="color: #666666;" onmouseover="this.style.color='#e50914'; this.style.transform='translateY(-2px)'" onmouseout="this.style.color='#666666'; this.style.transform='translateY(0px)'">Próximos estrenos</a>
          </nav>
        </div>
      </div>
    </div>

    <div class="flex">
      <aside class="w-80 flex-shrink-0">
        <FilterSidebar client:load ciudades={cities} cines={cinemas} />
      </aside>
      
      <div class="flex-1 p-8">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
          {movies.length > 0 ? (
            movies.map((pelicula, index) => (
              <a href={`/${pelicula.id}`} class="block group">
                <div class="rounded-xl overflow-hidden hover:transform hover:-translate-y-3 hover:shadow-2xl transition-all duration-300 relative border-2 movie-card" style="background-color: #ffffff; border-color: #e5ddd0; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);">
                  <div class="aspect-[3/4] overflow-hidden">
                    <img
                      src={pelicula.imagen_url || '/images/placeholder.jpg'}
                      alt={`Carátula de ${pelicula.titulo}`}
                      class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
                    />
                  </div>
                  
                  <div class="p-6" style="background: linear-gradient(to bottom, #ffffff, #fafafa);">
                    <h2 class="text-xl font-bold mb-3 line-clamp-2 group-hover:text-red-500 transition-colors duration-300" style="color: #2c2c2c;">
                      {pelicula.titulo}
                    </h2>
                    <p class="text-sm font-medium" style="color: #666666;">
                      {pelicula.genero}, {pelicula.duracion}min, +{pelicula.clasificacion || '14'}.
                    </p>
                  </div>
                  
                  <!-- Indicador de hover -->
                  <div class="absolute top-4 right-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    <div class="w-3 h-3 rounded-full" style="background-color: #e50914; box-shadow: 0 0 15px rgba(229, 9, 20, 0.6);"></div>
                  </div>
                </div>
              </a>
            ))
          ) : (
            <div class="col-span-full text-center py-16">
              <p class="text-2xl font-medium" style="color: #666666;">No hay películas en cartelera.</p>
            </div>
          )}
        </div>
      </div>
    </div>
  </main>
</Layout>

<style>
  .border-b-3 {
    border-bottom-width: 3px;
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .aspect-\[3\/4\] {
    aspect-ratio: 3/4;
  }

  /* Fondo crema elegante */
  body, html, main {
    background: linear-gradient(180deg, #f8f5f0 0%, #f2ede6 50%, #ede7dc 100%) !important;
    color: #2c2c2c !important;
  }
  
  /* Asegurar que el contenedor mantenga el fondo */
  .container {
    background-color: transparent !important;
  }

  /* Efecto hover rojo corporativo para las cards */
  .movie-card:hover {
    border-color: #e50914 !important;
    box-shadow: 0 25px 50px rgba(229, 9, 20, 0.2) !important;
    transform: translateY(-12px) scale(1.02) !important;
  }

  /* Colores corporativos para bordes */
  .border-gray-700 {
    border-color: #e5ddd0 !important;
  }

  /* Efecto hover para títulos de películas */
  .group:hover .group-hover\:text-red-500 {
    color: #e50914 !important;
    text-shadow: 1px 1px 3px rgba(229, 9, 20, 0.2) !important;
  }

  /* Transiciones suaves y elegantes */
  * {
    transition-property: color, background-color, border-color, box-shadow, transform, opacity;
    transition-duration: 300ms;
    transition-timing-function: cubic-bezier(0.4, 0.0, 0.2, 1);
  }

  /* Mejorar contraste en texto */
  h1, h2, h3 {
    letter-spacing: -0.025em;
  }

  /* Sombras suaves para depth */
  .movie-card {
    backdrop-filter: blur(10px);
  }
</style>